<!DOCTYPE html>
<html lang="pt-BR">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Catálogo de Filmes - Fase 3: Exibindo Mais Dados</title>
<link rel="stylesheet" href="style.css">

</head>
<body>

<h1>Catálogo de Filmes</h1>

<form id="cadastro-filme">
<h2>Adicionar Novo Filme (Busca por API)</h2>
<div>
<label for="titulo">Título do Filme:</label>
<input type="text" id="titulo" required> 
</div>
<button type="submit">Buscar e Adicionar Filme</button>
</form>
<hr>

<h2>Minha Lista De Filmes</h2>

<div id="lista-filmes">
<p>Nenhum filme cadastrado ainda.</p>
</div>

<script>
// A CHAVE SECRETA DA API OMDb (Substitua este string pela sua chave real!)
const API_KEY = ' 463ada0f'; 

// 1. ARMAZENAMENTO DE DADOS 
const catalogo = [];

// 2. CAPTURA DE ELEMENTOS DO DOM (Document Object Model)
const form = document.getElementById('cadastro-filme');
const tituloInput = document.getElementById('titulo');
const listaFilmesContainer = document.getElementById('lista-filmes');

// ------------------------------------------------------------------
// FUNÇÃO DE REMOÇÃO 
// ------------------------------------------------------------------
function removerFilme(indice, elementoDOM) {
    catalogo.splice(indice, 1);
    elementoDOM.remove();

    if (catalogo.length  === 0){
        listaFilmesContainer.innerHTML = '<p>Nenhum filme cadastrado ainda.</p>';
    }
}

// -------------------------------------------------------------
// FUNÇÃO DE RENDERIZAÇÃO (ATUALIZADA)
// -------------------------------------------------------------
function renderizarFilme(filme, indice) {
    if (catalogo.length === 1 && listaFilmesContainer.querySelector('p')) {
        listaFilmesContainer.innerHTML = ''; 
    }

    const filmeDiv = document.createElement('div');
    filmeDiv.classList.add('filme-item');

// A. Elemento Imagem (Pôster)
const imagemPoster = document.createElement('img');
imagemPoster.src = filme.poster && filme.poster !== 'N/A'
                   ? filme.poster
                   : 'https://via.placeholder.com/100x150?text=Poster+Nao+Disponivel';
imagemPoster.alt = `Pôster do filme ${filme.titulo}`;
imagemPoster.classList.add('filme-poster');

// B. Elementos de Texto e Info
const infoDiv = document.createElement('div');
infoDiv.classList.add('filme-info');

const tituloH3 = document.createElement('h3');
tituloH3.textContent = filme.titulo;

// NOVO: Elemento para o Ano de Lançamento
const infoExtraDiv = document.createElement('div');
infoExtraDiv.classList.add('filme-extra-info');
infoExtraDiv.innerHTML = `
    <span class="filme-ano">Ano: ${filme.ano}</span>
    <span class="filme-rating">Nota IMDb: ${filme.imdbRating}</span>
`;


const sinopseP = document.createElement('p');
sinopseP.textContent = filme.sinopse;

const removerBotao = document.createElement('button');
removerBotao.textContent = 'Remover';
removerBotao.classList.add('btn-remover');

// C. Evento de Remoção
removerBotao.addEventListener('click', () => {
    // Usa o índice armazenado para remover o item correto do array
    const indiceAtual = catalogo.findIndex(f => f.titulo === filme.titulo);
    if (indiceAtual > -1) {
          removerFilme(indiceAtual, filmeDiv);
    }
});

// D. Montagem do DOM
infoDiv.appendChild(tituloH3);
infoDiv.appendChild(infoExtraDiv); // Adiciona a div com Ano e Nota
infoDiv.appendChild(sinopseP);
infoDiv.appendChild(removerBotao);

filmeDiv.appendChild(imagemPoster);
filmeDiv.appendChild(infoDiv);

listaFilmesContainer.appendChild(filmeDiv);
}

// ----------------------------------------------------------------------------------
// FUNÇÃO PRINCIPAL DE ADIÇÃO (ATUALIZADA)
// ----------------------------------------------------------------------------------
async function adicionarFilme(evento) {
    evento.preventDefault();

const titulo = tituloInput.value.trim();
if (!titulo) return;

const tituloFormatado = encodeURIComponent(titulo);
const url = `https://www.omdbapi.com/?apikey=${API_KEY}&t=${tituloFormatado}`;

try {
    const resposta = await fetch(url);
    const dadosDoFilme = await resposta.json();

    if (dadosDoFilme.Response === "True") {

        const novoFilme = {
            titulo: dadosDoFilme.Title,
            sinopse: dadosDoFilme.Plot,
            poster: dadosDoFilme.Poster,
            // NOVOS DADOS COLETADOS DA API
            ano: dadosDoFilme.Year || 'N/A', // Coleta o ano
            imdbRating: dadosDoFilme.imdbRating || 'N/A' // Coleta a nota
        };

        catalogo.push(novoFilme);
        renderizarFilme(novoFilme, catalogo.length - 1);
    }  else{
        alert(`Filme não encontrado na OMDb: "${titulo}".`);
    }

} catch (error) {
    alert('Ocorreu um erro ao tentar buscar o filme na API. Verifique sua chave.');
    console.error('Erro de Fetch:', error);
}

form.reset();
}

// 6. ESCUTANDO O EVENTO DO FORMULÁRIO
form.addEventListener('submit', adicionarFilme);

</script>

</body>
</html>